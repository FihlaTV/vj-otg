<!DOCTYPE html>
<html>

<head>
	<title>Hello!</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="manifest" href="/vjotg.webmanifest">

	<link rel="stylesheet" href="/style/style.css">
	<script src="vendor/three.js/three.min.js"></script>
	<script src="vendor/three.js/Detector.js"></script>
	<script src="https://cdn.rawgit.com/webcomponents/webcomponentsjs/edf84e6e/webcomponents-sd-ce.js"></script>
	<script src="/components/html-element-plus.js"></script>

	<script src="/components/visuals/visuals.js" defer></script>
	<script src="/components/visuals/group.js" defer></script>
	<script src="/components/visuals/asset.js" defer></script>
	<script src="/components/visuals/distort.js" defer></script>
	<script src="/components/visuals/filter.js" defer></script>
	<script src="/components/visuals/source.js" defer></script>
	<script src="/components/visuals/uniforms.js" defer></script>

	<script src="/components/midi-cc.js" defer></script>
	<script src="/components/midi-pad.js" defer></script>

	<script src="/midi/akai.js" defer></script>
	<script src="/main.js" defer></script>
</head>

<body>
	<div class="wrapper" id="vjotg">

		<header>
			<h1>VJ On.The.Go</h1>
		</header>

		<!-- Where visuals.js does it's rendering -->
		<div id="screen">
			<vj-otg-visuals>

				<!-- load any assets that you want to use -->
				<vj-otg-assets>
					<video id="minnie" src="./assets/minnie-512.webm" width="512" height="512" autoplay="true" loop="true"></video>
					<video id="potus" src="./assets/potus.webm" width="512" height="512" autoplay="true" loop="true"></video>
					<img id="shera" src="./assets/shera.jpg" />
					<img id="hamster" src="./assets/hamster.jpg" />
				</vj-otg-assets>

				<!-- One can change attributes dynamically but do not remove/reorder/add or shader should recompile -->
				<!-- refer to these assets later by assing them as sources here -->
				<vj-otg-source type="texture" src="#minnie" name="minnie" index="1"></vj-otg-source>
				<vj-otg-source type="texture" src="#potus" name="potus" index="2"></vj-otg-source>
				<vj-otg-source type="texture" src="#shera" name="shera" index="3"></vj-otg-source>

				<!-- other uniforms you might want to use later -->
				<vj-otg-uniform type="analyser" threshold="80"></vj-otg-uniform>
				<vj-otg-uniform type="time"></vj-otg-uniform>

				<vj-otg-uniform type="midi" name="cc1" midi-el="#cc1"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc2" midi-el="#cc2"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc3" midi-el="#cc3"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc4" midi-el="#cc4"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc5" midi-el="#cc5"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc6" midi-el="#cc6"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc7" midi-el="#cc7"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="cc8" midi-el="#cc8"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad1" midi-el="#pad1"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad2" midi-el="#pad2"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad3" midi-el="#pad3"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad4" midi-el="#pad4"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad5" midi-el="#pad5"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad6" midi-el="#pad6"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad7" midi-el="#pad7"></vj-otg-uniform>
				<vj-otg-uniform type="midi" name="pad8" midi-el="#pad8"></vj-otg-uniform>

				<!-- these are the groups for each media item, with effects and uniforms for controls -->

				<vj-otg-group name="minnieGroup">
					<vj-otg-filter type="splitx" size="[beat * 0.05]"></vj-otg-filter>
					<vj-otg-filter type="hsl-gradient" start="120,0.5,0.5" stop="180,1,0.8" direction="3"></vj-otg-filter>
				</vj-otg-group>

				<vj-otg-group name="potusGroup">
					<vj-otg-distort type="wave" t="[time]" frequency="3.0" amplitude="0.02" speed="0.5"></vj-otg-distort>
					<vj-otg-distort type="zoom" factor="[1.2 * pad1]" position="0.5, 0.5"></vj-otg-distort>
					<vj-otg-filter type="main">
						float distanceFromCenter = length(centerCoord - newUV);
					</vj-otg-filter>
					<!-- <vj-otg-distort type="rotate" angle="[sqrt(distanceFromCenter) * 1000.0 * (1.0 - cc2) + cc2 * 500.0 + 220.0]"></vj-otg-distort> -->
					<vj-otg-filter type="from-source" source="2"></vj-otg-filter>
				</vj-otg-group>

				<vj-otg-group name="graphGroup">
					<vj-otg-filter type="main">
						<pre><code lang="glsl">

							// Work in polar coordinates
							newUV.x = (PI + atan(newUV.x - 0.5, newUV.y - 0.5)) / (2.0 * PI);
							newUV.y = distanceFromCenter;

							// Get the current column and it's value
							int column = int(newUV.x * noAnalyserBins);
							float columnValue = (
								(float(column == 0) * analyser[0]) +
								(float(column == 1) * analyser[1]) +
								(float(column == 2) * analyser[2]) +
								(float(column == 3) * analyser[3]) +
								(float(column == 4) * analyser[4]) +
								(float(column == 5) * analyser[5]) +
								(float(column == 6) * analyser[6]) +
								(float(column == 7) * analyser[7]) +
								(float(column == 8) * analyser[8]) +
								(float(column == 9) * analyser[9]) +
								(float(column == 10) * analyser[10]) +
								(float(column == 11) * analyser[11]) +
								(float(column == 12) * analyser[12]) +
								(float(column == 13) * analyser[13]) +
								(float(column == 14) * analyser[14]) +
								(float(column == 15) * analyser[15]) +
								(float(column == 16) * analyser[16]) +
								(float(column == 17) * analyser[17]) +
								(float(column == 18) * analyser[18]) +
								(float(column == 19) * analyser[19])
							);

							// Each column is coloured using hsl
							vec3 rgbColumnColor = hsl2rgb(float(column)/noAnalyserBins, 1.0 , 0.5);

							// Work out whether that pixel should be coloured or not.
							graphGroup = mix(
								noopVec4,
								vec4(rgbColumnColor, 1.0),
								float(newUV.y &lt;= columnValue) * float(columnValue - newUV.y &lt;= 0.1 )
							);
					</code></pre>
					</vj-otg-filter>
				</vj-otg-group>

				<vj-otg-group name="sheraGroup">
					<vj-otg-filter type="main">
						float xOn = floor(mod(newUV.x * 8.0 , 2.0));
						float yOn = floor(mod(newUV.y * 8.0 , 2.0));
						[layer] = vec4(mix(xOn , 1.0 - xOn, yOn), pad1, 0.0, 1.0) * texture2D(shera, newUV);
						[layer] = mix([layer], graphGroup, cc1 * graphGroup.a);
					</vj-otg-filter>
				</vj-otg-group>

				<!-- this is everything and mixes all the previous media groups -->
				<vj-otg-filter type="main">
					float perlinNoise = clamp(snoise(vec3(newUV * 5.0, cc1)), 0.0, 1.0);
					[layer] = mix(minnieGroup, potusGroup * graphGroup, cc1 * cc1);
				</vj-otg-filter>

			</vj-otg-visuals>
		</div>
		<!--screen-->

		<!-- <nav class="media__select">
			<ul>
				<li class="thumb thumb__master" data-media="master">
					<span>M</span>
				</li>
				<li class="thumb" data-media="minnie">
					<img src="./assets/" alt="Thumbnail of Minnie video clip" />
				</li>
				<li class="thumb" data-media="hamster">
					<img src="./assets/hamster.jpg" alt="" />
				</li>
				<li class="thumb" data-media="shera">
					<img class="thumb" src="./assets/shera.jpg" alt="" />
				</li>
			</ul>
		</nav> -->

		<section class="midi-controls">
			<!-- set values between 0-127 -->
			<midi-pad channel-press="144" channel-release="128" note="36" value="64" id="pad1">PAD1</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="37" value="127" id="pad2">PAD2</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="38" value="64" id="pad3">PAD3</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="39" value="64" id="pad4">PAD4</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="40" value="64" id="pad5">PAD5</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="41" value="64" id="pad6">PAD6</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="42" value="64" id="pad7">PAD7</midi-pad>
			<midi-pad channel-press="144" channel-release="128" note="43" value="64" id="pad8">PAD8</midi-pad>

			<midi-cc id="cc1" channel="176" note="1" value="64">CC1</midi-cc>
			<midi-cc id="cc2" channel="176" note="2" value="64">CC2</midi-cc>
			<midi-cc id="cc3" channel="176" note="3" value="64">CC3</midi-cc>
			<midi-cc id="cc4" channel="176" note="4" value="64">CC4</midi-cc>
			<midi-cc id="cc5" channel="176" note="5" value="64">CC5</midi-cc>
			<midi-cc id="cc6" channel="176" note="6" value="64">CC6</midi-cc>
			<midi-cc id="cc7" channel="176" note="7" value="64">CC7</midi-cc>
			<midi-cc id="cc8" channel="176" note="8" value="64">CC8</midi-cc>
		</section>
	</div>
	<!--wrapper-->

</body>

</html>